(()=>{"use strict";document.addEventListener("DOMContentLoaded",function(){console.log("Popup界面已加载");const e=document.getElementById("uploadArea"),t=document.getElementById("fileInput"),n=document.getElementById("status"),o=document.getElementById("progress"),r=document.getElementById("progressBar"),s=document.getElementById("openSidePanel"),a=document.getElementById("viewHistory");let c=!1;function i(e){console.log("处理文件:",e);const t=["application/pdf","text/plain","image/jpeg","image/png"],n=e.filter(e=>-1!==t.indexOf(e.type));0!==n.length?(n.length!==e.length&&f(`已过滤掉 ${e.length-n.length} 个不支持的文件`,"info"),n.filter(e=>e.size>10485760).length>0?f("文件大小不能超过10MB","error"):async function(e){if(!c){c=!0,m(!0),f("正在上传文件...","info");try{const t=[];for(let n=0;n<e.length;n++){const o=e[n];p((n+1)/e.length*100),f(`正在上传 ${o.name}...`,"info");const r=await u({type:"UPLOAD_FILE",data:{file:o,type:"popup"}});t.push(r)}const n=t.filter(e=>e.success).length,o=t.length-n;0===o?f(`成功上传 ${n} 个文件`,"success"):f(`成功 ${n} 个，失败 ${o} 个`,"error"),setTimeout(()=>{!async function(e){f("正在处理文件...","info");for(const t of e)t.success&&t.data&&await d(t.data)}(t)},1e3)}catch(e){console.error("上传失败:",e),f("上传失败，请重试","error")}finally{c=!1,setTimeout(()=>m(!1),2e3)}}}(n)):f("请选择支持的文件格式 (PDF, TXT, JPG, PNG)","error")}async function d(e){try{f("正在识别手写内容...","info");const t=await u({type:"PROCESS_MYSCRIPT",data:e});t.success?(f("识别完成，正在AI批改...","info"),await async function(e){try{const t=await u({type:"PROCESS_DEEPSEEK",data:e});t.success?(f("AI批改完成！","success"),await async function(e){try{(await u({type:"SAVE_SUBMISSION",data:e})).success&&(f("结果已保存，点击侧边栏查看详情","success"),setTimeout(()=>{l()},2e3))}catch(e){console.error("保存失败:",e),f("保存失败","error")}}(t.data)):f("AI批改失败","error")}catch(e){console.error("Deepseek处理失败:",e),f("AI批改失败","error")}}(t.data)):f("识别失败","error")}catch(e){console.error("MyScript处理失败:",e),f("识别处理失败","error")}}async function l(){try{if("undefined"==typeof chrome)throw new Error("Chrome扩展API不可用");if(chrome.sidePanel&&chrome.sidePanel.open){const[e]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!e||!e.id)throw new Error("无法获取当前标签页");await chrome.sidePanel.open({tabId:e.id}),window.close()}else if(chrome.sidePanel&&chrome.sidePanel.setOptions)await chrome.sidePanel.setOptions({path:"sidepanel/index.html",enabled:!0}),f("侧边栏已启用，请点击浏览器侧边栏按钮打开","success");else{const e=chrome.runtime.getURL("sidepanel/index.html");await chrome.tabs.create({url:e}),window.close()}}catch(e){console.error("打开侧边栏失败:",e);const t=e instanceof Error?e.message:"未知错误";t.includes("API Unavailable")||t.includes("sidePanel")?(f("Chrome版本不支持侧边栏，正在新标签页中打开...","info"),setTimeout(async()=>{try{const e=chrome.runtime.getURL("sidepanel/index.html");await chrome.tabs.create({url:e}),window.close()}catch(e){f("请手动打开插件进行使用","error")}},1e3)):f(`打开失败: ${t}`,"error")}}function u(e){return new Promise(t=>{chrome.runtime.sendMessage(e,e=>{t(e||{success:!1,error:"No response"})})})}function f(e,t="info"){n.textContent=e,n.className=`status ${t}`,n.style.display="block","error"!==t&&setTimeout(()=>{n.style.display="none"},3e3)}function m(e){o.style.display=e?"block":"none",e||(r.style.width="0%")}function p(e){r.style.width=Math.min(100,Math.max(0,e))+"%"}e.addEventListener("click",()=>{c||t.click()}),t.addEventListener("change",function(e){const t=e.target.files;t&&t.length>0&&i(Array.from(t))}),e.addEventListener("dragover",function(t){t.preventDefault(),e.classList.add("dragover")}),e.addEventListener("dragleave",function(t){t.preventDefault(),e.classList.remove("dragover")}),e.addEventListener("drop",function(t){t.preventDefault(),e.classList.remove("dragover");const n=t.dataTransfer?.files;n&&n.length>0&&i(Array.from(n))}),s.addEventListener("click",l),a.addEventListener("click",function(){f("历史记录功能开发中...","info")}),document.addEventListener("dragover",e=>e.preventDefault()),document.addEventListener("drop",e=>e.preventDefault()),u({type:"GET_USER_STATUS"}).then(e=>{e.success&&e.data.isLoggedIn?f("已登录，可以开始使用","success"):f("欢迎使用AI微积分助教","info")}),console.log("Popup界面初始化完成")})})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wdXAvaW5kZXguanMiLCJtYXBwaW5ncyI6Im1CQUVBQSxTQUFTQyxpQkFBaUIsbUJBQW9CLFdBQzFDQyxRQUFRQyxJQUFJLGNBRVosTUFBTUMsRUFBYUosU0FBU0ssZUFBZSxjQUNyQ0MsRUFBWU4sU0FBU0ssZUFBZSxhQUNwQ0UsRUFBU1AsU0FBU0ssZUFBZSxVQUNqQ0csRUFBV1IsU0FBU0ssZUFBZSxZQUNuQ0ksRUFBY1QsU0FBU0ssZUFBZSxlQUN0Q0ssRUFBbUJWLFNBQVNLLGVBQWUsaUJBQzNDTSxFQUFpQlgsU0FBU0ssZUFBZSxlQUUvQyxJQUFJTyxHQUFjLEVBa0RsQixTQUFTQyxFQUFZQyxHQUNqQlosUUFBUUMsSUFBSSxRQUFTVyxHQUVyQixNQUFNQyxFQUFpQixDQUFDLGtCQUFtQixhQUFjLGFBQWMsYUFDakVDLEVBQWFGLEVBQU1HLE9BQU9DLElBQ2tCLElBQXZDSCxFQUFlSSxRQUFRRCxFQUFLRSxPQUViLElBQXRCSixFQUFXSyxRQUlYTCxFQUFXSyxTQUFXUCxFQUFNTyxRQUM1QkMsRUFBVyxRQUFRUixFQUFNTyxPQUFTTCxFQUFXSyxpQkFBa0IsUUFJNUNMLEVBQVdDLE9BQU9DLEdBQVFBLEVBQUtLLEtBRHRDLFVBRUdGLE9BQVMsRUFDeEJDLEVBQVcsZUFBZ0IsU0FPbkNFLGVBQTJCVixHQUN2QixJQUFJRixFQUFKLENBRUFBLEdBQWMsRUFDZGEsR0FBYSxHQUNiSCxFQUFXLFlBQWEsUUFDeEIsSUFDSSxNQUFNSSxFQUFVLEdBQ2hCLElBQUssSUFBSUMsRUFBSSxFQUFHQSxFQUFJYixFQUFNTyxPQUFRTSxJQUFLLENBQ25DLE1BQU1ULEVBQU9KLEVBQU1hLEdBRW5CQyxHQURtQkQsRUFBSSxHQUFLYixFQUFNTyxPQUFVLEtBRTVDQyxFQUFXLFFBQVFKLEVBQUtXLFVBQVcsUUFFbkMsTUFBTUMsUUFBZUMsRUFBaUIsQ0FDbENYLEtBQU0sY0FDTlksS0FBTSxDQUFFZCxPQUFNRSxLQUFNLFdBRXhCTSxFQUFRTyxLQUFLSCxFQUNqQixDQUVBLE1BQU1JLEVBQWVSLEVBQVFULE9BQU9rQixHQUFLQSxFQUFFQyxTQUFTZixPQUM5Q2dCLEVBQVlYLEVBQVFMLE9BQVNhLEVBQ2pCLElBQWRHLEVBQ0FmLEVBQVcsUUFBUVksUUFBb0IsV0FHdkNaLEVBQVcsTUFBTVksVUFBcUJHLE1BQWUsU0FHekRDLFdBQVcsTUFjbkJkLGVBQW9DRSxHQUNoQ0osRUFBVyxZQUFhLFFBQ3hCLElBQUssTUFBTVEsS0FBVUosRUFDYkksRUFBT00sU0FBV04sRUFBT0UsWUFFbkJPLEVBQW9CVCxFQUFPRSxLQUc3QyxDQXJCWVEsQ0FBcUJkLElBQ3RCLElBQ1AsQ0FDQSxNQUFPZSxHQUNIdkMsUUFBUXVDLE1BQU0sUUFBU0EsR0FDdkJuQixFQUFXLFdBQVksUUFDM0IsQ0FDQSxRQUNJVixHQUFjLEVBQ2QwQixXQUFXLElBQU1iLEdBQWEsR0FBUSxJQUMxQyxDQXZDVSxDQXdDZCxDQTdDSWlCLENBQVkxQixJQWRSTSxFQUFXLGtDQUFtQyxRQWV0RCxDQXdEQUUsZUFBZWUsRUFBb0JJLEdBQy9CLElBQ0lyQixFQUFXLGNBQWUsUUFDMUIsTUFBTXNCLFFBQWlCYixFQUFpQixDQUNwQ1gsS0FBTSxtQkFDTlksS0FBTVcsSUFFTkMsRUFBU1IsU0FDVGQsRUFBVyxpQkFBa0IsY0FjekNFLGVBQW1DcUIsR0FDL0IsSUFDSSxNQUFNRCxRQUFpQmIsRUFBaUIsQ0FDcENYLEtBQU0sbUJBQ05ZLEtBQU1hLElBRU5ELEVBQVNSLFNBQ1RkLEVBQVcsVUFBVyxpQkFjbENFLGVBQThCc0IsR0FDMUIsV0FDMkJmLEVBQWlCLENBQ3BDWCxLQUFNLGtCQUNOWSxLQUFNYyxLQUVHVixVQUNUZCxFQUFXLGtCQUFtQixXQUU5QmdCLFdBQVcsS0FDUFMsS0FDRCxLQUVYLENBQ0EsTUFBT04sR0FDSHZDLFFBQVF1QyxNQUFNLFFBQVNBLEdBQ3ZCbkIsRUFBVyxPQUFRLFFBQ3ZCLENBQ0osQ0E5QmtCMEIsQ0FBZUosRUFBU1osT0FHOUJWLEVBQVcsU0FBVSxRQUU3QixDQUNBLE1BQU9tQixHQUNIdkMsUUFBUXVDLE1BQU0sZ0JBQWlCQSxHQUMvQm5CLEVBQVcsU0FBVSxRQUN6QixDQUNKLENBL0JrQjJCLENBQW9CTCxFQUFTWixPQUduQ1YsRUFBVyxPQUFRLFFBRTNCLENBQ0EsTUFBT21CLEdBQ0h2QyxRQUFRdUMsTUFBTSxnQkFBaUJBLEdBQy9CbkIsRUFBVyxTQUFVLFFBQ3pCLENBQ0osQ0EyQ0FFLGVBQWV1QixJQUNYLElBRUksR0FBc0Isb0JBQVhHLE9BQ1AsTUFBTSxJQUFJQyxNQUFNLGtCQUdwQixHQUFJRCxPQUFPRSxXQUFhRixPQUFPRSxVQUFVQyxLQUFNLENBRTNDLE1BQU9DLFNBQWFKLE9BQU9LLEtBQUtDLE1BQU0sQ0FBRUMsUUFBUSxFQUFNQyxlQUFlLElBQ3JFLElBQUtKLElBQVFBLEVBQUlLLEdBQ2IsTUFBTSxJQUFJUixNQUFNLG1CQUVkRCxPQUFPRSxVQUFVQyxLQUFLLENBQUVPLE1BQU9OLEVBQUlLLEtBQ3pDRSxPQUFPQyxPQUNYLE1BQ0ssR0FBSVosT0FBT0UsV0FBYUYsT0FBT0UsVUFBVVcsaUJBRXBDYixPQUFPRSxVQUFVVyxXQUFXLENBQzlCQyxLQUFNLHVCQUNOQyxTQUFTLElBRWIzQyxFQUFXLHVCQUF3QixlQUVsQyxDQUVELE1BQU00QyxFQUFNaEIsT0FBT2lCLFFBQVFDLE9BQU8sOEJBQzVCbEIsT0FBT0ssS0FBS2MsT0FBTyxDQUFFSCxRQUMzQkwsT0FBT0MsT0FDWCxDQUNKLENBQ0EsTUFBT3JCLEdBQ0h2QyxRQUFRdUMsTUFBTSxXQUFZQSxHQUUxQixNQUFNNkIsRUFBZTdCLGFBQWlCVSxNQUFRVixFQUFNOEIsUUFBVSxPQUMxREQsRUFBYUUsU0FBUyxvQkFBc0JGLEVBQWFFLFNBQVMsY0FDbEVsRCxFQUFXLDhCQUErQixRQUUxQ2dCLFdBQVdkLFVBQ1AsSUFDSSxNQUFNMEMsRUFBTWhCLE9BQU9pQixRQUFRQyxPQUFPLDhCQUM1QmxCLE9BQU9LLEtBQUtjLE9BQU8sQ0FBRUgsUUFDM0JMLE9BQU9DLE9BQ1gsQ0FDQSxNQUFPVyxHQUNIbkQsRUFBVyxjQUFlLFFBQzlCLEdBQ0QsTUFHSEEsRUFBVyxTQUFTZ0QsSUFBZ0IsUUFFNUMsQ0FDSixDQU9BLFNBQVN2QyxFQUFpQndDLEdBQ3RCLE9BQU8sSUFBSUcsUUFBU0MsSUFDaEJ6QixPQUFPaUIsUUFBUVMsWUFBWUwsRUFBVTNCLElBQ2pDK0IsRUFBUS9CLEdBQVksQ0FBRVIsU0FBUyxFQUFPSyxNQUFPLG1CQUd6RCxDQUVBLFNBQVNuQixFQUFXaUQsRUFBU25ELEVBQU8sUUFDaENiLEVBQU9zRSxZQUFjTixFQUNyQmhFLEVBQU91RSxVQUFZLFVBQVUxRCxJQUM3QmIsRUFBT3dFLE1BQU1DLFFBQVUsUUFFVixVQUFUNUQsR0FDQWtCLFdBQVcsS0FDUC9CLEVBQU93RSxNQUFNQyxRQUFVLFFBQ3hCLElBRVgsQ0FFQSxTQUFTdkQsRUFBYXdELEdBQ2xCekUsRUFBU3VFLE1BQU1DLFFBQVVDLEVBQU8sUUFBVSxPQUNyQ0EsSUFDRHhFLEVBQVlzRSxNQUFNRyxNQUFRLEtBRWxDLENBRUEsU0FBU3RELEVBQWV1RCxHQUNwQjFFLEVBQVlzRSxNQUFNRyxNQUFRRSxLQUFLQyxJQUFJLElBQUtELEtBQUtFLElBQUksRUFBR0gsSUFBWSxHQUNwRSxDQXJSSS9FLEVBQVdILGlCQUFpQixRQUFTLEtBQzVCVyxHQUNETixFQUFVaUYsVUFJbEJqRixFQUFVTCxpQkFBaUIsU0FhL0IsU0FBMEJ1RixHQUN0QixNQUNNMUUsRUFEUzBFLEVBQU1DLE9BQ0EzRSxNQUNqQkEsR0FBU0EsRUFBTU8sT0FBUyxHQUN4QlIsRUFBWTZFLE1BQU1DLEtBQUs3RSxHQUUvQixHQWpCSVYsRUFBV0gsaUJBQWlCLFdBbUJoQyxTQUF3QnVGLEdBQ3BCQSxFQUFNSSxpQkFDTnhGLEVBQVd5RixVQUFVQyxJQUFJLFdBQzdCLEdBckJJMUYsRUFBV0gsaUJBQWlCLFlBdUJoQyxTQUF5QnVGLEdBQ3JCQSxFQUFNSSxpQkFDTnhGLEVBQVd5RixVQUFVRSxPQUFPLFdBQ2hDLEdBekJJM0YsRUFBV0gsaUJBQWlCLE9BMkJoQyxTQUFvQnVGLEdBQ2hCQSxFQUFNSSxpQkFDTnhGLEVBQVd5RixVQUFVRSxPQUFPLFlBQzVCLE1BQU1qRixFQUFRMEUsRUFBTVEsY0FBY2xGLE1BQzlCQSxHQUFTQSxFQUFNTyxPQUFTLEdBQ3hCUixFQUFZNkUsTUFBTUMsS0FBSzdFLEdBRS9CLEdBaENJSixFQUFpQlQsaUJBQWlCLFFBQVM4QyxHQUMzQ3BDLEVBQWVWLGlCQUFpQixRQXNPcEMsV0FFSXFCLEVBQVcsZUFBZ0IsT0FDL0IsR0F2T0l0QixTQUFTQyxpQkFBaUIsV0FBYWdHLEdBQU1BLEVBQUVMLGtCQUMvQzVGLFNBQVNDLGlCQUFpQixPQUFTZ0csR0FBTUEsRUFBRUwsa0JBeVEvQzdELEVBQWlCLENBQUVYLEtBQU0sb0JBQXFCOEUsS0FBS3RELElBQzNDQSxFQUFTUixTQUFXUSxFQUFTWixLQUFLbUUsV0FDbEM3RSxFQUFXLGFBQWMsV0FHekJBLEVBQVcsY0FBZSxVQUdsQ3BCLFFBQVFDLElBQUksZUFDaEIsRSIsInNvdXJjZXMiOlsid2VicGFjazovL2NhbGN1bHVzLWFpLWV4dGVuc2lvbi8uL3NyYy9wb3B1cC9pbmRleC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG4vLyBDaHJvbWXmj5Lku7ZQb3B1cOeVjOmdouiEmuacrFxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGZ1bmN0aW9uICgpIHtcbiAgICBjb25zb2xlLmxvZygnUG9wdXDnlYzpnaLlt7LliqDovb0nKTtcbiAgICAvLyDojrflj5ZET03lhYPntKBcbiAgICBjb25zdCB1cGxvYWRBcmVhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3VwbG9hZEFyZWEnKTtcbiAgICBjb25zdCBmaWxlSW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZUlucHV0Jyk7XG4gICAgY29uc3Qgc3RhdHVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXR1cycpO1xuICAgIGNvbnN0IHByb2dyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzJyk7XG4gICAgY29uc3QgcHJvZ3Jlc3NCYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZ3Jlc3NCYXInKTtcbiAgICBjb25zdCBvcGVuU2lkZVBhbmVsQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ29wZW5TaWRlUGFuZWwnKTtcbiAgICBjb25zdCB2aWV3SGlzdG9yeUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2aWV3SGlzdG9yeScpO1xuICAgIC8vIOaWh+S7tuS4iuS8oOebuOWFs1xuICAgIGxldCBpc1VwbG9hZGluZyA9IGZhbHNlO1xuICAgIC8vIOWIneWni+WMluS6i+S7tuebkeWQrFxuICAgIGZ1bmN0aW9uIGluaXRFdmVudExpc3RlbmVycygpIHtcbiAgICAgICAgLy8g5LiK5Lyg5Yy65Z+f54K55Ye7XG4gICAgICAgIHVwbG9hZEFyZWEuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIWlzVXBsb2FkaW5nKSB7XG4gICAgICAgICAgICAgICAgZmlsZUlucHV0LmNsaWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAvLyDmlofku7bpgInmi6lcbiAgICAgICAgZmlsZUlucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGhhbmRsZUZpbGVTZWxlY3QpO1xuICAgICAgICAvLyDmi5bmi73kuovku7ZcbiAgICAgICAgdXBsb2FkQXJlYS5hZGRFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIGhhbmRsZURyYWdPdmVyKTtcbiAgICAgICAgdXBsb2FkQXJlYS5hZGRFdmVudExpc3RlbmVyKCdkcmFnbGVhdmUnLCBoYW5kbGVEcmFnTGVhdmUpO1xuICAgICAgICB1cGxvYWRBcmVhLmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCBoYW5kbGVEcm9wKTtcbiAgICAgICAgLy8g5oyJ6ZKu5LqL5Lu2XG4gICAgICAgIG9wZW5TaWRlUGFuZWxCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvcGVuU2lkZVBhbmVsKTtcbiAgICAgICAgdmlld0hpc3RvcnlCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB2aWV3SGlzdG9yeSk7XG4gICAgICAgIC8vIOmYsuatoum7mOiupOaLluaLveihjOS4ulxuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIChlKSA9PiBlLnByZXZlbnREZWZhdWx0KCkpO1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdkcm9wJywgKGUpID0+IGUucHJldmVudERlZmF1bHQoKSk7XG4gICAgfVxuICAgIC8vIOWkhOeQhuaWh+S7tumAieaLqVxuICAgIGZ1bmN0aW9uIGhhbmRsZUZpbGVTZWxlY3QoZXZlbnQpIHtcbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xuICAgICAgICBjb25zdCBmaWxlcyA9IHRhcmdldC5maWxlcztcbiAgICAgICAgaWYgKGZpbGVzICYmIGZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGhhbmRsZUZpbGVzKEFycmF5LmZyb20oZmlsZXMpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyDlpITnkIbmi5bmi73mgqzlgZxcbiAgICBmdW5jdGlvbiBoYW5kbGVEcmFnT3ZlcihldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB1cGxvYWRBcmVhLmNsYXNzTGlzdC5hZGQoJ2RyYWdvdmVyJyk7XG4gICAgfVxuICAgIC8vIOWkhOeQhuaLluaLveemu+W8gFxuICAgIGZ1bmN0aW9uIGhhbmRsZURyYWdMZWF2ZShldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB1cGxvYWRBcmVhLmNsYXNzTGlzdC5yZW1vdmUoJ2RyYWdvdmVyJyk7XG4gICAgfVxuICAgIC8vIOWkhOeQhuaWh+S7tuaLluaLvVxuICAgIGZ1bmN0aW9uIGhhbmRsZURyb3AoZXZlbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdXBsb2FkQXJlYS5jbGFzc0xpc3QucmVtb3ZlKCdkcmFnb3ZlcicpO1xuICAgICAgICBjb25zdCBmaWxlcyA9IGV2ZW50LmRhdGFUcmFuc2Zlcj8uZmlsZXM7XG4gICAgICAgIGlmIChmaWxlcyAmJiBmaWxlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBoYW5kbGVGaWxlcyhBcnJheS5mcm9tKGZpbGVzKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8g5aSE55CG5paH5Lu2XG4gICAgZnVuY3Rpb24gaGFuZGxlRmlsZXMoZmlsZXMpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ+WkhOeQhuaWh+S7tjonLCBmaWxlcyk7XG4gICAgICAgIC8vIOmqjOivgeaWh+S7tuexu+Wei1xuICAgICAgICBjb25zdCBzdXBwb3J0ZWRUeXBlcyA9IFsnYXBwbGljYXRpb24vcGRmJywgJ3RleHQvcGxhaW4nLCAnaW1hZ2UvanBlZycsICdpbWFnZS9wbmcnXTtcbiAgICAgICAgY29uc3QgdmFsaWRGaWxlcyA9IGZpbGVzLmZpbHRlcihmaWxlID0+IHtcbiAgICAgICAgICAgIHJldHVybiBzdXBwb3J0ZWRUeXBlcy5pbmRleE9mKGZpbGUudHlwZSkgIT09IC0xO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHZhbGlkRmlsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICBzaG93U3RhdHVzKCfor7fpgInmi6nmlK/mjIHnmoTmlofku7bmoLzlvI8gKFBERiwgVFhULCBKUEcsIFBORyknLCAnZXJyb3InKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodmFsaWRGaWxlcy5sZW5ndGggIT09IGZpbGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgc2hvd1N0YXR1cyhg5bey6L+H5ruk5o6JICR7ZmlsZXMubGVuZ3RoIC0gdmFsaWRGaWxlcy5sZW5ndGh9IOS4quS4jeaUr+aMgeeahOaWh+S7tmAsICdpbmZvJyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8g5qOA5p+l5paH5Lu25aSn5bCPXG4gICAgICAgIGNvbnN0IG1heFNpemUgPSAxMCAqIDEwMjQgKiAxMDI0OyAvLyAxME1CXG4gICAgICAgIGNvbnN0IG92ZXJzaXplZEZpbGVzID0gdmFsaWRGaWxlcy5maWx0ZXIoZmlsZSA9PiBmaWxlLnNpemUgPiBtYXhTaXplKTtcbiAgICAgICAgaWYgKG92ZXJzaXplZEZpbGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHNob3dTdGF0dXMoJ+aWh+S7tuWkp+Wwj+S4jeiDvei2hei/hzEwTUInLCAnZXJyb3InKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyDlvIDlp4vkuIrkvKBcbiAgICAgICAgdXBsb2FkRmlsZXModmFsaWRGaWxlcyk7XG4gICAgfVxuICAgIC8vIOS4iuS8oOaWh+S7tlxuICAgIGFzeW5jIGZ1bmN0aW9uIHVwbG9hZEZpbGVzKGZpbGVzKSB7XG4gICAgICAgIGlmIChpc1VwbG9hZGluZylcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgaXNVcGxvYWRpbmcgPSB0cnVlO1xuICAgICAgICBzaG93UHJvZ3Jlc3ModHJ1ZSk7XG4gICAgICAgIHNob3dTdGF0dXMoJ+ato+WcqOS4iuS8oOaWh+S7ti4uLicsICdpbmZvJyk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHRzID0gW107XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGZpbGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlsZSA9IGZpbGVzW2ldO1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb2dyZXNzID0gKChpICsgMSkgLyBmaWxlcy5sZW5ndGgpICogMTAwO1xuICAgICAgICAgICAgICAgIHVwZGF0ZVByb2dyZXNzKHByb2dyZXNzKTtcbiAgICAgICAgICAgICAgICBzaG93U3RhdHVzKGDmraPlnKjkuIrkvKAgJHtmaWxlLm5hbWV9Li4uYCwgJ2luZm8nKTtcbiAgICAgICAgICAgICAgICAvLyDlj5HpgIHliLBiYWNrZ3JvdW5kIHNjcmlwdFxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlbmRUb0JhY2tncm91bmQoe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnVVBMT0FEX0ZJTEUnLFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7IGZpbGUsIHR5cGU6ICdwb3B1cCcgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJlc3VsdHMucHVzaChyZXN1bHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8g5aSE55CG5LiK5Lyg57uT5p6cXG4gICAgICAgICAgICBjb25zdCBzdWNjZXNzQ291bnQgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuc3VjY2VzcykubGVuZ3RoO1xuICAgICAgICAgICAgY29uc3QgZmFpbENvdW50ID0gcmVzdWx0cy5sZW5ndGggLSBzdWNjZXNzQ291bnQ7XG4gICAgICAgICAgICBpZiAoZmFpbENvdW50ID09PSAwKSB7XG4gICAgICAgICAgICAgICAgc2hvd1N0YXR1cyhg5oiQ5Yqf5LiK5LygICR7c3VjY2Vzc0NvdW50fSDkuKrmlofku7ZgLCAnc3VjY2VzcycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc2hvd1N0YXR1cyhg5oiQ5YqfICR7c3VjY2Vzc0NvdW50fSDkuKrvvIzlpLHotKUgJHtmYWlsQ291bnR9IOS4qmAsICdlcnJvcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8g562J5b6F5LiA5LiL54S25ZCO5aSE55CG5paH5Lu2XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBwcm9jZXNzVXBsb2FkZWRGaWxlcyhyZXN1bHRzKTtcbiAgICAgICAgICAgIH0sIDEwMDApO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcign5LiK5Lyg5aSx6LSlOicsIGVycm9yKTtcbiAgICAgICAgICAgIHNob3dTdGF0dXMoJ+S4iuS8oOWksei0pe+8jOivt+mHjeivlScsICdlcnJvcicpO1xuICAgICAgICB9XG4gICAgICAgIGZpbmFsbHkge1xuICAgICAgICAgICAgaXNVcGxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gc2hvd1Byb2dyZXNzKGZhbHNlKSwgMjAwMCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8g5aSE55CG5LiK5Lyg5a6M5oiQ55qE5paH5Lu2XG4gICAgYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc1VwbG9hZGVkRmlsZXMocmVzdWx0cykge1xuICAgICAgICBzaG93U3RhdHVzKCfmraPlnKjlpITnkIbmlofku7YuLi4nLCAnaW5mbycpO1xuICAgICAgICBmb3IgKGNvbnN0IHJlc3VsdCBvZiByZXN1bHRzKSB7XG4gICAgICAgICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MgJiYgcmVzdWx0LmRhdGEpIHtcbiAgICAgICAgICAgICAgICAvLyDosIPnlKhNeVNjcmlwdOivhuWIq1xuICAgICAgICAgICAgICAgIGF3YWl0IHByb2Nlc3NXaXRoTXlTY3JpcHQocmVzdWx0LmRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8vIE15U2NyaXB06K+G5Yir5aSE55CGXG4gICAgYXN5bmMgZnVuY3Rpb24gcHJvY2Vzc1dpdGhNeVNjcmlwdChmaWxlRGF0YSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgc2hvd1N0YXR1cygn5q2j5Zyo6K+G5Yir5omL5YaZ5YaF5a65Li4uJywgJ2luZm8nKTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgc2VuZFRvQmFja2dyb3VuZCh7XG4gICAgICAgICAgICAgICAgdHlwZTogJ1BST0NFU1NfTVlTQ1JJUFQnLFxuICAgICAgICAgICAgICAgIGRhdGE6IGZpbGVEYXRhXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgc2hvd1N0YXR1cygn6K+G5Yir5a6M5oiQ77yM5q2j5ZyoQUnmibnmlLkuLi4nLCAnaW5mbycpO1xuICAgICAgICAgICAgICAgIC8vIOe7p+e7rURlZXBzZWVr5om55pS5XG4gICAgICAgICAgICAgICAgYXdhaXQgcHJvY2Vzc1dpdGhEZWVwc2VlayhyZXNwb25zZS5kYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHNob3dTdGF0dXMoJ+ivhuWIq+Wksei0pScsICdlcnJvcicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignTXlTY3JpcHTlpITnkIblpLHotKU6JywgZXJyb3IpO1xuICAgICAgICAgICAgc2hvd1N0YXR1cygn6K+G5Yir5aSE55CG5aSx6LSlJywgJ2Vycm9yJyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gRGVlcHNlZWsgQUnmibnmlLlcbiAgICBhc3luYyBmdW5jdGlvbiBwcm9jZXNzV2l0aERlZXBzZWVrKG15U2NyaXB0RGF0YSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzZW5kVG9CYWNrZ3JvdW5kKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnUFJPQ0VTU19ERUVQU0VFSycsXG4gICAgICAgICAgICAgICAgZGF0YTogbXlTY3JpcHREYXRhXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgc2hvd1N0YXR1cygnQUnmibnmlLnlrozmiJDvvIEnLCAnc3VjY2VzcycpO1xuICAgICAgICAgICAgICAgIC8vIOS/neWtmOe7k+aenFxuICAgICAgICAgICAgICAgIGF3YWl0IHNhdmVTdWJtaXNzaW9uKHJlc3BvbnNlLmRhdGEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc2hvd1N0YXR1cygnQUnmibnmlLnlpLHotKUnLCAnZXJyb3InKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0RlZXBzZWVr5aSE55CG5aSx6LSlOicsIGVycm9yKTtcbiAgICAgICAgICAgIHNob3dTdGF0dXMoJ0FJ5om55pS55aSx6LSlJywgJ2Vycm9yJyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8g5L+d5a2Y5L2c5Lia5o+Q5LqkXG4gICAgYXN5bmMgZnVuY3Rpb24gc2F2ZVN1Ym1pc3Npb24oZ3JhZGluZ1Jlc3VsdCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzZW5kVG9CYWNrZ3JvdW5kKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnU0FWRV9TVUJNSVNTSU9OJyxcbiAgICAgICAgICAgICAgICBkYXRhOiBncmFkaW5nUmVzdWx0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgc2hvd1N0YXR1cygn57uT5p6c5bey5L+d5a2Y77yM54K55Ye75L6n6L655qCP5p+l55yL6K+m5oOFJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAvLyDoh6rliqjmiZPlvIDkvqfovrnmoI9cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgb3BlblNpZGVQYW5lbCgpO1xuICAgICAgICAgICAgICAgIH0sIDIwMDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcign5L+d5a2Y5aSx6LSlOicsIGVycm9yKTtcbiAgICAgICAgICAgIHNob3dTdGF0dXMoJ+S/neWtmOWksei0pScsICdlcnJvcicpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIOaJk+W8gOS+p+i+ueagj1xuICAgIGFzeW5jIGZ1bmN0aW9uIG9wZW5TaWRlUGFuZWwoKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyDmo4Dmn6VDaHJvbWXniYjmnKzlkoxBUEnlj6/nlKjmgKdcbiAgICAgICAgICAgIGlmICh0eXBlb2YgY2hyb21lID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2hyb21l5omp5bGVQVBJ5LiN5Y+v55SoJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyDlsJ3or5XkuI3lkIznmoTmlrnlvI/miZPlvIDkvqfovrnmoI9cbiAgICAgICAgICAgIGlmIChjaHJvbWUuc2lkZVBhbmVsICYmIGNocm9tZS5zaWRlUGFuZWwub3Blbikge1xuICAgICAgICAgICAgICAgIC8vIENocm9tZSAxMTQrIOeahOaWsEFQSVxuICAgICAgICAgICAgICAgIGNvbnN0IFt0YWJdID0gYXdhaXQgY2hyb21lLnRhYnMucXVlcnkoeyBhY3RpdmU6IHRydWUsIGN1cnJlbnRXaW5kb3c6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgaWYgKCF0YWIgfHwgIXRhYi5pZCkge1xuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ+aXoOazleiOt+WPluW9k+WJjeagh+etvumhtScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhd2FpdCBjaHJvbWUuc2lkZVBhbmVsLm9wZW4oeyB0YWJJZDogdGFiLmlkIH0pO1xuICAgICAgICAgICAgICAgIHdpbmRvdy5jbG9zZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY2hyb21lLnNpZGVQYW5lbCAmJiBjaHJvbWUuc2lkZVBhbmVsLnNldE9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICAvLyDlpIfnlKjmlrnmoYjvvJrorr7nva7kvqfovrnmoI/pgInpoblcbiAgICAgICAgICAgICAgICBhd2FpdCBjaHJvbWUuc2lkZVBhbmVsLnNldE9wdGlvbnMoe1xuICAgICAgICAgICAgICAgICAgICBwYXRoOiAnc2lkZXBhbmVsL2luZGV4Lmh0bWwnLFxuICAgICAgICAgICAgICAgICAgICBlbmFibGVkOiB0cnVlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgc2hvd1N0YXR1cygn5L6n6L655qCP5bey5ZCv55So77yM6K+354K55Ye75rWP6KeI5Zmo5L6n6L655qCP5oyJ6ZKu5omT5byAJywgJ3N1Y2Nlc3MnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIOmZjee6p+aWueahiO+8muaJk+W8gOaWsOagh+etvumhtVxuICAgICAgICAgICAgICAgIGNvbnN0IHVybCA9IGNocm9tZS5ydW50aW1lLmdldFVSTCgnc2lkZXBhbmVsL2luZGV4Lmh0bWwnKTtcbiAgICAgICAgICAgICAgICBhd2FpdCBjaHJvbWUudGFicy5jcmVhdGUoeyB1cmwgfSk7XG4gICAgICAgICAgICAgICAgd2luZG93LmNsb3NlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCfmiZPlvIDkvqfovrnmoI/lpLHotKU6JywgZXJyb3IpO1xuICAgICAgICAgICAgLy8g5pi+56S655So5oi35Y+L5aW955qE6ZSZ6K+v5L+h5oGvXG4gICAgICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICfmnKrnn6XplJnor68nO1xuICAgICAgICAgICAgaWYgKGVycm9yTWVzc2FnZS5pbmNsdWRlcygnQVBJIFVuYXZhaWxhYmxlJykgfHwgZXJyb3JNZXNzYWdlLmluY2x1ZGVzKCdzaWRlUGFuZWwnKSkge1xuICAgICAgICAgICAgICAgIHNob3dTdGF0dXMoJ0Nocm9tZeeJiOacrOS4jeaUr+aMgeS+p+i+ueagj++8jOato+WcqOaWsOagh+etvumhteS4reaJk+W8gC4uLicsICdpbmZvJyk7XG4gICAgICAgICAgICAgICAgLy8g5aSH6YCJ5pa55qGI77ya5paw5qCH562+6aG15omT5byAXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB1cmwgPSBjaHJvbWUucnVudGltZS5nZXRVUkwoJ3NpZGVwYW5lbC9pbmRleC5odG1sJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBjaHJvbWUudGFicy5jcmVhdGUoeyB1cmwgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZmFsbGJhY2tFcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2hvd1N0YXR1cygn6K+35omL5Yqo5omT5byA5o+S5Lu26L+b6KGM5L2/55SoJywgJ2Vycm9yJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHNob3dTdGF0dXMoYOaJk+W8gOWksei0pTogJHtlcnJvck1lc3NhZ2V9YCwgJ2Vycm9yJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8g5p+l55yL5Y6G5Y+y6K6w5b2VXG4gICAgZnVuY3Rpb24gdmlld0hpc3RvcnkoKSB7XG4gICAgICAgIC8vIOWunueOsOWOhuWPsuiusOW9leafpeeci+WKn+iDvVxuICAgICAgICBzaG93U3RhdHVzKCfljoblj7LorrDlvZXlip/og73lvIDlj5HkuK0uLi4nLCAnaW5mbycpO1xuICAgIH1cbiAgICAvLyDlj5HpgIHmtojmga/liLBiYWNrZ3JvdW5kIHNjcmlwdFxuICAgIGZ1bmN0aW9uIHNlbmRUb0JhY2tncm91bmQobWVzc2FnZSkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgICAgICAgIGNocm9tZS5ydW50aW1lLnNlbmRNZXNzYWdlKG1lc3NhZ2UsIChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UgfHwgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdObyByZXNwb25zZScgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8vIOaYvuekuueKtuaAgeS/oeaBr1xuICAgIGZ1bmN0aW9uIHNob3dTdGF0dXMobWVzc2FnZSwgdHlwZSA9ICdpbmZvJykge1xuICAgICAgICBzdGF0dXMudGV4dENvbnRlbnQgPSBtZXNzYWdlO1xuICAgICAgICBzdGF0dXMuY2xhc3NOYW1lID0gYHN0YXR1cyAke3R5cGV9YDtcbiAgICAgICAgc3RhdHVzLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xuICAgICAgICAvLyAz56eS5ZCO6Ieq5Yqo6ZqQ6JeP77yI6Zmk6Z2e5piv6ZSZ6K+v77yJXG4gICAgICAgIGlmICh0eXBlICE9PSAnZXJyb3InKSB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICBzdGF0dXMuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgICAgIH0sIDMwMDApO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIOaYvuekui/pmpDol4/ov5vluqbmnaFcbiAgICBmdW5jdGlvbiBzaG93UHJvZ3Jlc3Moc2hvdykge1xuICAgICAgICBwcm9ncmVzcy5zdHlsZS5kaXNwbGF5ID0gc2hvdyA/ICdibG9jaycgOiAnbm9uZSc7XG4gICAgICAgIGlmICghc2hvdykge1xuICAgICAgICAgICAgcHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSAnMCUnO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIOabtOaWsOi/m+W6puadoVxuICAgIGZ1bmN0aW9uIHVwZGF0ZVByb2dyZXNzKHBlcmNlbnQpIHtcbiAgICAgICAgcHJvZ3Jlc3NCYXIuc3R5bGUud2lkdGggPSBNYXRoLm1pbigxMDAsIE1hdGgubWF4KDAsIHBlcmNlbnQpKSArICclJztcbiAgICB9XG4gICAgLy8g5Yid5aeL5YyWXG4gICAgaW5pdEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgLy8g5qOA5p+l55So5oi354q25oCBXG4gICAgc2VuZFRvQmFja2dyb3VuZCh7IHR5cGU6ICdHRVRfVVNFUl9TVEFUVVMnIH0pLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICBpZiAocmVzcG9uc2Uuc3VjY2VzcyAmJiByZXNwb25zZS5kYXRhLmlzTG9nZ2VkSW4pIHtcbiAgICAgICAgICAgIHNob3dTdGF0dXMoJ+W3sueZu+W9le+8jOWPr+S7peW8gOWni+S9v+eUqCcsICdzdWNjZXNzJyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzaG93U3RhdHVzKCfmrKLov47kvb/nlKhBSeW+ruenr+WIhuWKqeaVmScsICdpbmZvJyk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBjb25zb2xlLmxvZygnUG9wdXDnlYzpnaLliJ3lp4vljJblrozmiJAnKTtcbn0pO1xuIl0sIm5hbWVzIjpbImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImNvbnNvbGUiLCJsb2ciLCJ1cGxvYWRBcmVhIiwiZ2V0RWxlbWVudEJ5SWQiLCJmaWxlSW5wdXQiLCJzdGF0dXMiLCJwcm9ncmVzcyIsInByb2dyZXNzQmFyIiwib3BlblNpZGVQYW5lbEJ0biIsInZpZXdIaXN0b3J5QnRuIiwiaXNVcGxvYWRpbmciLCJoYW5kbGVGaWxlcyIsImZpbGVzIiwic3VwcG9ydGVkVHlwZXMiLCJ2YWxpZEZpbGVzIiwiZmlsdGVyIiwiZmlsZSIsImluZGV4T2YiLCJ0eXBlIiwibGVuZ3RoIiwic2hvd1N0YXR1cyIsInNpemUiLCJhc3luYyIsInNob3dQcm9ncmVzcyIsInJlc3VsdHMiLCJpIiwidXBkYXRlUHJvZ3Jlc3MiLCJuYW1lIiwicmVzdWx0Iiwic2VuZFRvQmFja2dyb3VuZCIsImRhdGEiLCJwdXNoIiwic3VjY2Vzc0NvdW50IiwiciIsInN1Y2Nlc3MiLCJmYWlsQ291bnQiLCJzZXRUaW1lb3V0IiwicHJvY2Vzc1dpdGhNeVNjcmlwdCIsInByb2Nlc3NVcGxvYWRlZEZpbGVzIiwiZXJyb3IiLCJ1cGxvYWRGaWxlcyIsImZpbGVEYXRhIiwicmVzcG9uc2UiLCJteVNjcmlwdERhdGEiLCJncmFkaW5nUmVzdWx0Iiwib3BlblNpZGVQYW5lbCIsInNhdmVTdWJtaXNzaW9uIiwicHJvY2Vzc1dpdGhEZWVwc2VlayIsImNocm9tZSIsIkVycm9yIiwic2lkZVBhbmVsIiwib3BlbiIsInRhYiIsInRhYnMiLCJxdWVyeSIsImFjdGl2ZSIsImN1cnJlbnRXaW5kb3ciLCJpZCIsInRhYklkIiwid2luZG93IiwiY2xvc2UiLCJzZXRPcHRpb25zIiwicGF0aCIsImVuYWJsZWQiLCJ1cmwiLCJydW50aW1lIiwiZ2V0VVJMIiwiY3JlYXRlIiwiZXJyb3JNZXNzYWdlIiwibWVzc2FnZSIsImluY2x1ZGVzIiwiZmFsbGJhY2tFcnJvciIsIlByb21pc2UiLCJyZXNvbHZlIiwic2VuZE1lc3NhZ2UiLCJ0ZXh0Q29udGVudCIsImNsYXNzTmFtZSIsInN0eWxlIiwiZGlzcGxheSIsInNob3ciLCJ3aWR0aCIsInBlcmNlbnQiLCJNYXRoIiwibWluIiwibWF4IiwiY2xpY2siLCJldmVudCIsInRhcmdldCIsIkFycmF5IiwiZnJvbSIsInByZXZlbnREZWZhdWx0IiwiY2xhc3NMaXN0IiwiYWRkIiwicmVtb3ZlIiwiZGF0YVRyYW5zZmVyIiwiZSIsInRoZW4iLCJpc0xvZ2dlZEluIl0sInNvdXJjZVJvb3QiOiIifQ==